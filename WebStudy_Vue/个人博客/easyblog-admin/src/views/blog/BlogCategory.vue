<template>
    <div>
        <el-button type="danger"
            @click="showEdit('add')">新增分类</el-button>
        <Table :columns="columns"
               :showPagination="false"
               :dataSource="tableData"
               :fetch="loadDataList"
               :options="tableOptions">
            <template #cover="{index,row}">
                <Cover :cover="row.cover"></Cover>
            </template>
            <template #op="{index,row}">
                <div class="op">
                    <a href="javascript:void(0)" class="a-link"
                        @click="showEdit('update',row)">修改</a>
                    <el-divider direction="vertical"></el-divider>
                    <a href="javascript:void(0)" class="a-link">删除</a>
                    <el-divider direction="vertical"></el-divider>
                    <a href="javascript:void(0)" class="a-link">上移</a>
                    <el-divider direction="vertical"></el-divider>
                    <a href="javascript:void(0)" class="a-link">下移</a>
                </div>
            </template>
        </Table>
        <Dialog :show="dialogConfig.show"
                :title="dialogConfig.title" 
                :buttons="dialogConfig.buttons"
                @close="dialogConfig.show=false"
                width="500px">
                <el-form :model="formData" 
                         :rules="rules" 
                         ref="formDataRef">
                    <el-form-item label="名称"
                                  prop="account">
                        <el-input placeholder="请输入名称"
                            v-model="formData.categoryName">
                        </el-input>
                    </el-form-item>
                    <el-form-item label="封面"
                                  prop="cover">
                        <CoverUpload></CoverUpload>
                    </el-form-item>
                    <el-form-item label="简介">
                        <el-input placeholder="请输入简介"
                                  v-model="formData.categoryDesc" 
                                  type="textarea"
                                  :autosize="{minRows:4, maxRows:4}">
                        </el-input>
                    </el-form-item>
                    <el-form-item>
                        <el-checkbox v-model="formData.rememberMe"
                                    :value="rememberMe"
                                    :true-label="1" :false-label="2">记住我</el-checkbox>
                    </el-form-item>
                    <el-form-item>
                        <el-button type="primary" :style="{width:'100%'}" @click="login" >登录</el-button>
                    </el-form-item>
                </el-form>
        </Dialog>
    </div>

</template>
 
<script setup>

import { reactive, getCurrentInstance } from 'vue';
import Cover from '../../components/Cover.vue';
import CoverUpload from '../../components/CoverUpload.vue';

const { proxy } = getCurrentInstance();

const api = {
    "loadDataList": "/category/loadAllCategory4Blog"
}
const columns = [{
    label: "封面",
    prop: "cover",
    width: 80,
    scopedSlots: "cover",
},
{
    label: "名称",
    prop: "categoryName",
    width: 200,
},
{
    label: "简介",
    prop: "categoryDesc",
},
{
    label: "博客数量",
    prop: "blogCount",
    width: 100,
},
{
    label: "操作",
    prop: "op",
    width: 200,
    scopedSlots: "op",
}];

const tableData = reactive({})
const tableOptions = {
    extHeight: 10,
}

const loadDataList = async () => {
    let result = await proxy.Request({
        url: api.loadDataList
    })
    if(!result) {
        return;
    }
    tableData.list = result.data;
}

// 新增，修改
const dialogConfig = reactive({
    title: "标题",
    show: true,
    buttons: [{
        type: "danger",
        text: "确定",
        click: (e) => {
            console.log("xx");
        }
    }]
})

const formData = reactive({})
const rules = {}
const showEdit = (type, data) => {
    dialogConfig.show = true;
}

</script>

<style lang="scss">

</style>